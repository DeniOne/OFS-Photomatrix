# Инструкция по интеграции Telegram-бота с ERP-системой OFS-Photomatrix

## Необходимые компоненты

1. **Запущенный бэкенд OFS-Photomatrix** на порту 8000
2. **Настроенный Telegram-бот** с токеном от @BotFather

## Настройка бэкенда

1. Убедитесь, что бэкенд запущен и доступен по адресу `http://localhost:8000`
2. Убедитесь, что все необходимые API-эндпоинты созданы:
   - `/api/v1/positions` - для получения списка должностей
   - `/api/v1/staff` - для создания сотрудников
   - `/api/v1/utils/validate-invitation-code` - для валидации кодов приглашения
   - `/api/v1/divisions` - для получения списка подразделений
   - `/api/v1/auth/activate` - для активации пользователей

## Настройка и запуск бота

1. **Установка зависимостей**:
   ```bash
   cd telegram_bot
   python -m venv venv
   venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Настройка конфигурации**:
   - Проверьте файл `.env` и убедитесь, что указаны правильные значения:
     - `BOT_TOKEN` - токен Telegram-бота
     - `ADMIN_IDS` - ваш Telegram ID (получить можно у @userinfobot)
     - `API_URL` - URL API основной системы (по умолчанию `http://localhost:8000/api/v1`)

3. **Запуск бота**:
   ```bash
   python main.py
   ```

   Или запустите бота как службу Windows:
   ```bash
   .\deploy.ps1
   ```

## Проверка интеграции

1. **Откройте бота в Telegram** (по ссылке t.me/ваш_бот)
2. **Начните диалог** с командой `/start`
3. **Попробуйте зарегистрироваться**, следуя инструкциям бота
4. **Проверьте в админ-панели бота** (через команду `/admin`), что заявка на регистрацию создана
5. **Проверьте в ERP-системе**, что сотрудник и пользователь созданы

## Устранение неполадок

### Бот запускается, но не отвечает на команды
- Убедитесь, что токен бота верный
- Проверьте логи бота на наличие ошибок

### Бот не может подключиться к API
- Убедитесь, что бэкенд запущен
- Проверьте, что API URL в `.env` файле указан правильно
- Проверьте, что на бэкенде созданы все необходимые эндпоинты

### Ошибки при создании сотрудников
- Проверьте логи бота
- Проверьте логи бэкенда
- Убедитесь, что схемы данных совпадают между ботом и API

## Расширение функциональности

Для добавления новых функций в бота:
1. Изучите код в файлах:
   - `registration_handlers.py` - регистрация сотрудников
   - `admin_handlers.py` - функционал для администраторов
   - `api_client.py` - взаимодействие с API основной системы

2. Добавьте новые эндпоинты на бэкенде при необходимости
3. Расширьте функционал бота, добавив новые обработчики команд 