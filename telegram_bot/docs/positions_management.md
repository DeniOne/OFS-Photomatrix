# Управление должностями в Telegram-боте

Данная инструкция описывает, как редактировать список должностей и отделов, доступных для выбора при регистрации сотрудников через Telegram-бот.

## Обзор системы

Telegram-бот использует локальные JSON-файлы для хранения списка должностей и отделов, которые доступны для выбора при регистрации новых сотрудников. Эта система обеспечивает работоспособность даже при недоступности основного API.

## Расположение файлов

Основные файлы находятся в директории `telegram_bot/data/`:

1. `positions.json` - содержит список должностей
2. `divisions.json` - содержит список отделов

## Формат данных

### Должности (positions.json)

```json
{
  "positions": [
    {
      "id": 1,
      "name": "Название должности",
      "description": "Описание должности"
    },
    ...
  ]
}
```

### Отделы (divisions.json)

```json
{
  "divisions": [
    {
      "id": 1,
      "name": "Название отдела",
      "description": "Описание отдела"
    },
    ...
  ]
}
```

## Способы обновления данных

### 1. Автоматическое обновление из API

Для автоматического обновления списка должностей из API основной системы:

1. Перейдите в папку `telegram_bot`
2. Запустите скрипт `update_positions.bat` или `python update_positions.py`
3. Скрипт попытается получить данные из API и обновить файл `positions.json`

### 2. Прямой экспорт из базы данных

Если API недоступен, можно экспортировать данные напрямую из базы данных:

1. Перейдите в папку `backend`
2. Запустите скрипт `export_positions.bat` или `python export_positions.py`
3. Скрипт подключится к БД и создаст обновленный файл должностей для бота

### 3. Ручное редактирование

Если автоматические методы недоступны, можно отредактировать файл вручную:

1. Откройте файл `telegram_bot/data/positions.json` в любом текстовом редакторе
2. Внесите необходимые изменения:
   - Для добавления новой должности - добавьте новый объект в массив `positions`
   - Для изменения существующей должности - найдите нужный объект по `id` и измените поля `name` и/или `description`
   - Для удаления должности - удалите соответствующий объект из массива
3. **Важно:** Убедитесь, что:
   - ID должностей уникальны
   - JSON-файл сохранен в формате UTF-8
   - Структура JSON соответствует приведенному выше формату
   - Файл не содержит синтаксических ошибок

## Применение изменений

После обновления файла должностей:

1. Если бот уже запущен:
   - Изменения вступят в силу автоматически в течение 1 часа (период обновления кэша)
   - Для немедленного применения изменений перезапустите бота

2. Если бот еще не запущен:
   - Изменения будут применены при следующем запуске бота

## Пример: Добавление новой должности

1. Откройте файл `telegram_bot/data/positions.json`
2. Найдите последнюю должность в массиве (обычно с самым большим ID)
3. Добавьте новую должность в конец массива, увеличив ID на 1:

```json
{
  "positions": [
    ... существующие должности ...
    {
      "id": 11,
      "name": "Системный аналитик",
      "description": "Анализ и проектирование систем"
    }
  ]
}
```

4. Сохраните файл и перезапустите бота для применения изменений

## Пример: Удаление должности

1. Откройте файл `telegram_bot/data/positions.json`
2. Найдите должность, которую нужно удалить
3. Удалите весь объект, включая фигурные скобки:

```json
{
  "positions": [
    ... должности до удаляемой ...
    
    ... должности после удаляемой ...
  ]
}
```

4. Сохраните файл и перезапустите бота для применения изменений

## Важные примечания

- После изменения JSON-файлов рекомендуется перезапустить бота для обновления кэша
- Кэш данных обновляется автоматически каждый час, но моментальное обновление происходит только при перезапуске
- Желательно сначала проверить синтаксис JSON с помощью онлайн-валидатора, например на сайте [JSONLint](https://jsonlint.com/)
- Рекомендуется создавать резервные копии файлов перед редактированием
- При возникновении проблем после редактирования файлов можно восстановить файлы из резервных копий 