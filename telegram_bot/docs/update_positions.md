# Обновление должностей в Telegram-боте из основной системы

Этот документ описывает, как обновить список должностей в Telegram-боте на основе данных из основной системы.

## Общая информация

Telegram-бот использует локальный JSON-файл `data/positions.json` для хранения списка должностей, которые доступны для выбора при регистрации новых сотрудников. Этот файл можно обновить автоматически из API основной системы с помощью специального скрипта.

## Автоматическое обновление

Для автоматического обновления списка должностей запустите подготовленный batch-файл:

1. Откройте папку `telegram_bot` в проводнике
2. Дважды щелкните на файле `update_positions.bat`
3. Дождитесь завершения процесса обновления

Скрипт выполнит следующие действия:
- Подключится к API основной системы
- Получит актуальный список должностей
- Сохранит данные в файл `data/positions.json`

## Ручное обновление

Если вы предпочитаете обновить файл вручную, выполните следующие шаги:

1. Получите актуальный список должностей из основной системы (через API или экспорт)
2. Откройте файл `telegram_bot/data/positions.json` в текстовом редакторе
3. Обновите содержимое файла, сохраняя формат:

```json
{
  "positions": [
    {
      "id": 1,
      "name": "Название должности",
      "description": "Описание должности"
    },
    ...
  ]
}
```

4. Сохраните файл в кодировке UTF-8

## Обновление в действии

После обновления файла `positions.json`:

1. **Если бот запущен:** Обновленный список должностей будет использоваться автоматически при следующем запросе (в течение часа, в зависимости от настроек кэширования)
2. **Мгновенное применение:** Для немедленного применения изменений перезапустите бота

## Проверка обновления

Чтобы проверить, что новый список должностей загружен:

1. Откройте диалог с ботом
2. Начните процесс регистрации
3. На шаге выбора должности вы увидите обновленный список

## Возможные проблемы

**Ошибка при получении данных из API:**
- Проверьте подключение к серверу API
- Убедитесь, что в файле `.env` указан правильный URL API
- Проверьте наличие API-ключа, если он требуется

**Ошибка при сохранении файла:**
- Убедитесь, что у пользователя есть права на запись в директорию `data`
- Проверьте, не открыт ли файл в другом приложении

**Некорректное отображение русских символов:**
- Убедитесь, что файл сохранен в кодировке UTF-8
- Проверьте, что символы корректно экранированы в JSON 