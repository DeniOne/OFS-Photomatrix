# План-напоминалка: Интеграция Чат-бота с системой регистрации пользователей

Этот документ описывает предполагаемый флоу регистрации и активации пользователей через будущего чат-бота.

## Концепция

Чат-бот будет служить как:
1.  **Личный кабинет сотрудника:** Для первичной регистрации, получения информации и т.д.
2.  **Админка:** Для управления ботом и, возможно, некоторыми функциями ERP.

Процесс предоставления доступа сотруднику к основному веб-приложению ERP через бота будет использовать существующую на бэкенде логику (модели `Staff`, `User`, `activation_code`, эндпоинт активации).

## Предполагаемый Флоу

1.  **Регистрация Сотрудника через Бота:**
    *   Новый сотрудник взаимодействует с ботом для первичной регистрации (предоставляет ФИО, контакты и т.д.).
    *   Бот (или админ через админку бота) создает запись `Staff` в базе данных основного приложения, вызывая соответствующий API (например, `POST /api/v1/staff/`).
    *   **Важно:** При создании `Staff` обязательно указывается должность (`Position`). Email сотрудника также должен быть получен и сохранен.
2.  **Проверка Прав Доступа:**
    *   Система (бот или админ через бота) проверяет атрибуты назначенной должности (`Position`).
    *   Определяется, имеет ли сотрудник право на доступ к веб-приложению ERP на основе своей должности (например, по специальному флагу или уровню доступа в модели `Position`).
3.  **Инициация Создания Пользователя:**
    *   Если доступ разрешен, админ (через админку бота) или сам бот (если автоматизировано) инициирует процесс создания пользователя для данного сотрудника.
    *   Это включает вызов бэкенд API основного приложения (вероятно, тот же `POST /api/v1/staff/` с `create_user: true` или модифицированный/новый эндпоинт, если нужен более гранулярный контроль).
4.  **Генерация Пользователя и Кода:**
    *   Бэкенд основного приложения создает запись `User`, связанную со `Staff`, генерирует `activation_code` (как и при создании через веб-интерфейс).
    *   Бэкенд возвращает `activation_code` в ответе API.
5.  **Доставка Кода Сотруднику:**
    *   Бот (получив код от API) сообщает `activation_code` сотруднику через чат.
    *   Либо админ получает код через админку бота и передает его сотруднику.
6.  **Активация в Веб-Приложении:**
    *   Сотрудник использует полученный код для активации своего аккаунта в **основном веб-приложении ERP**, перейдя на страницу "Первый вход / Активация".
    *   Процесс активации идентичен тому, что используется при создании пользователя через веб-интерфейс (используется эндпоинт `POST /api/v1/auth/activate`).

## Технические Заметки

*   **Переиспользование Бэкенда:** Основная логика (модели БД, генерация кода, эндпоинт активации `/auth/activate`) используется повторно. Нет необходимости дублировать ее для бота.
*   **API для Бота:** Потребуется определить, какие эндпоинты основного API бэкенда будет вызывать бэкенд чат-бота (создание `Staff`, возможно, запрос на создание `User`, получение информации о должностях и т.д.). Возможно, потребуются специальные эндпоинты или токены доступа для взаимодействия между сервисами.
*   **Модель `Position`:** Убедиться, что модель `Position` содержит необходимые атрибуты для определения права доступа к ERP.
*   **Безопасность:** Обеспечить безопасное взаимодействие между ботом и основным API, а также безопасную передачу кодов активации.

## Текущий Статус

*   Бэкенд основного приложения готов к генерации пользователей с кодами активации.
*   Эндпоинт активации (`/auth/activate`) существует.
*   Необходимо реализовать логику на стороне чат-бота и его бэкенда, а также, возможно, доработать модель `Position` и API основного бэкенда для взаимодействия с ботом. 