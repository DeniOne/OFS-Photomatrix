# Памятка: Регистрация и активация пользователя в системе

Этот документ описывает текущий процесс создания пользователя для сотрудника и его активации.

## Основной флоу

1.  **Создание Сотрудника:** Администратор (или пользователь с соответствующими правами) создает новую запись о сотруднике (`Staff`) через интерфейс приложения (используя API `POST /api/v1/staff/`).
2.  **Запрос на создание пользователя:** Во время создания сотрудника администратор устанавливает флаг (чекбокс) "Создать пользователя для доступа к системе" (`create_user: true` в запросе к API).
    *   **Важно:** У сотрудника должен быть указан **Email**, иначе создать пользователя не получится.
3.  **Генерация Пользователя и Кода:**
    *   Бэкенд получает запрос, создает запись `Staff`.
    *   Если `create_user`=true и указан email, бэкенд создает связанную запись `User` с этим email.
    *   Пароль для `User` **не устанавливается**. Вместо этого генерируется уникальный, криптографически стойкий **Код Активации** (`activation_code`).
    *   Бэкенд сохраняет `User` с кодом активации и привязывает `user_id` к записи `Staff`.
4.  **Получение Кода Администратором:**
    *   API `POST /api/v1/staff/` возвращает данные созданного сотрудника (`Staff`) **и** сгенерированный `activation_code`.
    *   Фронтенд приложения **должен отобразить** этот код администратору (например, в уведомлении или в деталях созданного сотрудника).
5.  **Передача Кода Сотруднику:** Администратор **безопасным способом** передает полученный Код Активации сотруднику (лично, по защищенному каналу и т.д.).
6.  **Активация Сотрудником:**
    *   Сотрудник заходит на страницу входа в приложение.
    *   Выбирает опцию "Первый вход / Активация аккаунта".
    *   Вводит полученный **Код Активации** и придумывает свой **пароль** (отвечающий требованиям безопасности, мин. 8 символов).
    *   Фронтенд отправляет данные на API `POST /api/v1/auth/activate`.
7.  **Завершение Активации:**
    *   Бэкенд проверяет код активации.
    *   Если код верный и пользователь еще не активирован, бэкенд устанавливает хеш пароля для пользователя, удаляет код активации и помечает пользователя как активного.
    *   Сотрудник может войти в систему со своим email и только что созданным паролем.

## Ключевые моменты

*   Пользователи создаются **только** через привязку к сотруднику с указанием email.
*   Первоначальный вход и установка пароля происходит через **одноразовый код активации**.
*   **Ответственность** за получение и безопасную передачу кода активации лежит на администраторе.
*   Фронтенд должен корректно обрабатывать ответ от `POST /staff` (показывать код) и предоставлять интерфейс для активации (`POST /auth/activate`). 